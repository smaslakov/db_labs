# IT Studio Portfolio Management System

Система управления портфелем IT‑студии на базе PostgreSQL и NestJS.

## Описание системы

Проект "Система управления портфелем IT‑студии" представляет собой комплексное веб‑приложение для оптимизации полного цикла работы IT‑компании. Основная цель системы — автоматизировать и централизовать все ключевые бизнес‑процессы: от управления клиентами и проектами до финансового учёта и аналитики. Она создана для того, чтобы заменить разрозненные инструменты (таблицы Excel, разные трекеры задач и т.д.) единой, надёжной платформой.

## Основные цели системы

**Повышение эффективности**: Упрощение и ускорение рутинных операций, таких как назначение задач, отслеживание времени и выставление счетов.

**Прозрачность**: Предоставление полного обзора по проектам, их бюджетам и прогрессу для всех заинтересованных сторон.

**Улучшение коммуникации**: Централизованное хранение данных о клиентах и проектах позволяет всем участникам команды быть в курсе текущих событий.

**Аналитика**: Сбор и обработка данных для получения отчётов о прибыльности, производительности команды и других ключевых бизнес‑показателях.

## Основные бизнес‑сущности системы

### Управление пользователями и доступом
- **Пользователи (Users)**: Все, кто имеет доступ к системе. У каждого пользователя есть определённая роль, которая определяет его права.
- **Роли (Roles)**: Определяют уровень доступа и набор разрешений для пользователей. Например, Администратор, Менеджер проекта, Разработчик и Клиент.
- **Разрешения (Permissions)**: Гранулярные права доступа к различным функциям системы.

### Клиентская база и проекты
- **Клиенты (Clients)**: Организации или физические лица, которые заказывают проекты у студии. Система хранит их контактные данные, историю отношений и портфолио их проектов.
- **Проекты (Projects)**: Центральная сущность. Каждый проект связан с определённым клиентом, имеет бюджет, сроки, статус и команду.
- **Участники проектов (Project Members)**: Набор пользователей, назначенных на конкретный проект, с определёнными ролями внутри него (например, Ведущий разработчик, UI/UX Дизайнер).

### Управление задачами
- **Задачи (Tasks)**: Проекты делятся на иерархическую структуру задач. Каждая задача имеет исполнителя, срок, статус и может быть разбита на подзадачи.
- **Статусы задач (Task Statuses)**: Определяют workflow выполнения задач (Новая → В работе → На проверке → Завершена).

### Учёт времени и ресурсов
- **Учёт времени (Time Entries)**: Записи о времени, которое разработчики потратили на выполнение определённых задач. Используется для расчёта стоимости и выставления счетов.

### Финансовое управление
- **Счета (Invoices)**: Финансовые документы, автоматически генерируемые на основе рабочего времени и договорённостей с клиентом.
- **Платежи (Payments)**: Записи о платежах, полученных от клиентов, для отслеживания финансового потока и статуса счетов.

### Безопасность и аудит
- **Пользовательские сессии (User Sessions)**: Управление авторизованными сессиями пользователей.
- **Журнал действий (Audit Logs)**: Хронология всех важных операций в системе, что обеспечивает прозрачность и безопасность.


## Архитектура

- **Backend**: NestJS с TypeScript
- **Database**: PostgreSQL 15
- **ORM**: Raw SQL запросы (без ORM)
- **Documentation**: Swagger/OpenAPI
- **Containerization**: Docker & Docker Compose
- **Package Manager**: pnpm
- **Type Safety**: Полная типизация TypeScript
- **Auto Initialization**: Автоматическая инициализация БД

## Структура проекта

Проект организован в виде модульной архитектуры с чёткым разделением ответственности:
- **NestJS приложение** с Docker Compose конфигурацией
- **Сервисы базы данных** с автоинициализацией и CRUD операциями
- **Модули приложения** для управления пользователями и проектами
- **TypeScript типы** для всех сущностей базы данных
- **DTO классы** для валидации входных данных
- **SQL скрипты** для инициализации базы данных

### Подробное описание таблиц

#### 1. Таблица `roles` — Роли
Определяет доступные роли в системе (например: admin, manager, employee, client).

- **id** `integer` — Уникальный идентификатор роли (PK)
- **name** `varchar(50)` — Название роли (например, "project_manager"). Должно быть уникальным
- **description** `text` — Человекочитаемое описание роли (для админки или документации)
- **created_at** `timestamp` — Дата создания роли. Полезно для аудита

#### 2. Таблица `users` — Пользователи
Хранит учётные записи пользователей системы.

- **id** `integer` — Уникальный ID пользователя (PK)
- **username** `varchar(50)` — Уникальное имя для входа (логин)
- **email** `varchar(100)` — Контактный email (уникальный)
- **password_hash** `varchar(255)` — Хэш пароля (никогда не хранится в открытом виде!)
- **first_name**, **last_name** `varchar(50)` — Имя и фамилия для отображения в интерфейсе
- **role_id** `integer` — Ссылка на роль пользователя (FK → `roles.id`)
- **hourly_rate** `decimal(10,2)` — Ставка за час (для расчёта оплаты/стоимости работ)
- **is_active** `boolean` — Флаг активности (можно "отключить" пользователя без удаления)
- **created_at**, **updated_at** `timestamp` — Время создания и последнего обновления профиля

#### 3. Таблица `permissions` — Разрешения
Описывает конкретные действия, которые можно выполнять в системе.

- **id** `integer` — Уникальный ID разрешения (PK)
- **name** `varchar(100)` — Уникальное название (например, "create_project", "delete_invoice")
- **description** `text` — Пояснение, что делает это разрешение
- **resource** `varchar(50)` — Ресурс, к которому применяется (например, "project", "invoice")
- **action** `varchar(20)` — Действие над ресурсом: "read", "create", "update", "delete"

**Пример:** resource = "task", action = "update" → разрешение на редактирование задач.

#### 4. Таблица `role_permissions` — Связь ролей и разрешений
Многие‑ко‑многим: какая роль имеет какие разрешения.

- **id** `integer` — PK (иногда не обязателен, но удобен)
- **role_id** `integer` — Ссылка на роль (FK → `roles.id`)
- **permission_id** `integer` — Ссылка на разрешение (FK → `permissions.id`)
- **granted_at** `timestamp` — Когда разрешение было выдано (для аудита)
- **Индекс** `(role_id, permission_id)` — Гарантирует, что одна роль не получит одно разрешение дважды


#### 5. Таблица `user_sessions` — Сессии пользователей
Отслеживает активные сессии (для безопасности и логаута).

- **user_id** `integer` — Кто вошёл в систему
- **session_token** `varchar(255)` — Уникальный токен сессии (хранится в куках/заголовках)
- **ip_address** `inet` — IP‑адрес входа (для обнаружения подозрительной активности)
- **user_agent** `text` — Информация о браузере/устройстве
- **created_at**, **expires_at** `timestamp` — Время начала и окончания сессии
- **is_active** `boolean` — Можно "разлогинить" пользователя, не дожидаясь истечения срока


#### 6. Таблица `audit_logs` — Журнал аудита
Фиксирует действия пользователей для отслеживания изменений.

- **user_id** `integer` — Кто совершил действие (может быть NULL для системных событий)
- **action** `varchar(50)` — Что сделано: "created", "updated", "deleted"
- **resource_type** `varchar(50)` — Тип сущности: "project", "invoice" и т.д.
- **resource_id** `integer` — ID изменённого объекта
- **old_values**, **new_values** `jsonb` — Старые и новые данные (полезно для отката)
- **ip_address**, **user_agent** — Откуда было действие
- **created_at** `timestamp` — Время события


#### 7. Таблица `clients` — Клиенты
Бизнес‑сущность: внешние заказчики.

- **company_name** `varchar(100)` — Название компании клиента
- **contact_person** `varchar(100)` — Контактное лицо
- **email**, **phone**, **address** — Контактные данные
- **tax_id** `varchar(50)` — ИНН или аналог (для юридических документов)
- **is_active** `boolean` — Активен ли клиент (можно архивировать)


#### 8. Таблица `projects` — Проекты
Основная бизнес‑единица.

- **client_id** `integer` — Для кого проект (FK → `clients.id`)
- **manager_id** `integer` — Ответственный менеджер (FK → `users.id`)
- **status**, **priority** `varchar` — Текущее состояние и важность
- **estimated_budget**, **actual_cost** `decimal` — Финансовое планирование
- **start_date**, **end_date** `date` — Плановые даты
- **actual_end_date** `date` — Фактическая дата завершения

#### 9. Таблица `project_members` — Участники проекта
Связь пользователей с проектами + их роль в проекте.

- **project_id**, **user_id** `integer` — Связь проект ↔ пользователь
- **role_in_project** `varchar(50)` — Например: "developer", "tester", "designer"
- **joined_at**, **left_at** `timestamp` — Период участия
- **is_active** `boolean` — Текущий ли участник


#### 10. Таблица `task_statuses` — Статусы задач
Гибкая настройка workflow задач.

- **name** `varchar(50)` — Например: "To Do", "In Progress", "Done"
- **color** `varchar(7)` — Цвет для отображения в интерфейсе (HEX)
- **is_final** `boolean` — Является ли статус завершающим (например, "Done")
- **sort_order** `integer` — Порядок отображения в списке

#### 11. Таблица `tasks` — Задачи
Работа в рамках проекта.

- **project_id** `integer` — К какому проекту относится
- **assigned_user_id** `integer` — Кто выполняет задачу
- **created_by_user_id** `integer` — Кто создал задачу
- **parent_task_id** `integer` — Для подзадач (иерархия)
- **completion_percentage** `integer` — Прогресс (0–100%)
- **completed_at** `timestamp` — Время завершения

**RBAC:** Проверка прав на задачу зависит от:
- Общей роли пользователя (can_edit_tasks?)
- Участия в проекте (project_members)
- Назначения на задачу (assigned_user_id)

#### 12. Таблица `time_entries` — Учёт времени
Фиксация затраченного времени на задачи.

- **user_id**, **task_id** `integer` — Кто сколько времени потратил на что
- **start_time**, **end_time** `timestamp` — Интервал работы
- **hours** `decimal(5,2)` — Рассчитанное время (может обновляться триггером)
- **is_billable** `boolean` — Оплачивается ли клиенту
- **hourly_rate** `decimal(10,2)` — Ставка на момент ввода (копируется из `users.hourly_rate`)

#### 13. Таблица `invoices` — Счета
Выставление счётов клиентам.

- **invoice_number** `varchar(50)` — Уникальный номер счёта
- **client_id** `integer` — Кому выставлен
- **project_id** `integer` — По какому проекту (может быть NULL)
- **subtotal**, **tax_amount**, **total_amount** `decimal` — Финансовые суммы
- **status** `varchar(20)` — "draft", "sent", "paid" и т.д.

#### 14. Таблица `payments` — Платежи
Оплата по счетам.

- **invoice_id** `integer` — По какому счёту оплата
- **amount**, **payment_date** — Сумма и дата
- **payment_method** `varchar(50)` — "bank_transfer", "credit_card" и т.д.
- **transaction_id** `varchar(100)` — ID транзакции (для интеграции с платёжными системами)

#### Связи (Relationships)
**RBAC‑ядро:** users → roles → role_permissions → permissions


## API Endpoints

### Управление приложением
- Проверка состояния приложения
- Статус инициализации БД
- Ручная инициализация БД

### Пользователи
- Список всех пользователей с ролями
- Активные пользователи
- Пользователи по роли
- CRUD операции для пользователей

### Проекты
- Список всех проектов с деталями
- Проекты по статусу
- Проекты клиента или менеджера
- Управление участниками проекта
- CRUD операции для проектов

## Планы развития

- Добавление аутентификации JWT
- Создание модулей для задач, клиентов, учёта времени и счетов
- Добавление валидации DTO
- Настройка логирования
